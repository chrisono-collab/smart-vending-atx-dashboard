name: Daily Vendsoft Sync

on:
  # schedule:
  #   - cron: '0 4 * * *'  # Disabled until automation is working
  workflow_dispatch:  # Manual trigger only for now

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # Setup Python environment
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # Install necessary tools for the Courier
      - name: Install dependencies
        run: |
          pip install playwright requests python-dotenv
          playwright install chromium

      # Execute the courier script using GitHub Secrets
      - name: Run Vendsoft Courier
        env:
          VENDSOFT_USER: ${{ secrets.VENDSOFT_USER }}
          VENDSOFT_PASS: ${{ secrets.VENDSOFT_PASS }}
          UPLOAD_ENDPOINT: https://smart-vending-atx-dashboard.vercel.app/api/upload
        run: python scripts/vendsoft_courier.py

      # Logging on failure
      - name: Notify on failure
        if: failure()
        run: echo "Vendsoft sync failed"
